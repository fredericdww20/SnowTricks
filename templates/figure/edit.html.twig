{% extends 'base.html.twig' %}

{% block body %}
    <h1 class="mt-5">Modifier la Figure</h1>
    {{ form_start(form) }}



    <ul id="image-fields-list" data-prototype="{{ form_widget(form.image.vars.prototype)|e('html_attr') }}">
        {% for imageField in form.image %}
            <li>
                {% if imageField.vars.data and imageField.vars.data.filename %}
                    <img src="{{ asset('uploads/images/' ~ imageField.vars.data.filename) }}" alt="{{ imageField.vars.data.filename }}">
                    <span>Nom du fichier : {{ imageField.vars.data.filename }}</span>
                {% endif %}
                {{ form_row(imageField.filename) }}
                <button class="delete-image" data-figure-id="{{ figure.id }}" data-image-id="{{ imageField.vars.data.id }}">Supprimer</button>
            </li>
        {% endfor %}
    </ul>

    <button type="button" id="add-image">Ajouter une image</button>

    <button type="submit">Sauvegarder les modifications</button>
    {{ form_end(form) }}

     <a href="{{ path('figure_show', {'id': figure.id}) }}">Retour Ã  la figure</a>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const imageFieldsList = document.getElementById('image-fields-list');
                const addImageButton = document.getElementById('add-image');
                const deleteImageButtons = document.querySelectorAll('.delete-image');

                addImageButton.addEventListener('click', function() {
                    const prototype = imageFieldsList.dataset.prototype;
                    const index = imageFieldsList.children.length;
                    const newForm = prototype.replace(/__name__/g, index);

                    imageFieldsList.insertAdjacentHTML('beforeend', newForm);
                });

                deleteImageButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const imageField = button.closest('li');
                        imageField.remove();
                    });
                });
            });

    document.addEventListener('DOMContentLoaded', function() {
            const imageFieldsList = document.getElementById('image-fields-list');
            const addImageButton = document.getElementById('add-image');

            addImageButton.addEventListener('click', function() {
                const prototype = imageFieldsList.dataset.prototype;
                const index = imageFieldsList.children.length;
                const newForm = prototype.replace(/__name__/g, index);

                imageFieldsList.insertAdjacentHTML('beforeend', newForm);
            });
        });
    </script>

{% endblock %}